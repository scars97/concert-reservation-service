# **장애 대응 문서 (가상)**

## **1. 장애 개요**

### **1.1 장애 영향 범위**

- 대기열 진입 API 응답 지연 발생
- 좌석 예약 API 요청 실패율 증가
- 일부 사용자 서비스 이용 불가

### **1.2 주요 증상**

| 항목 | 증상 |
| --- |---|
| 대기열 | 응답 시간 증가 (평균 1.28s, 최대 2.3s) |
| 좌석 예약 | 실패율 증가 (경합으로 인한 트랜잭션 충돌) |
| 서버 부하 | CPU 사용률 85% ~ 100% 지속, DB 응답 지연 |

---

## **2. 장애 감지 및 긴급 조치**

### **2.1 장애 감지 경로**

- APM 시스템에서 응답 지연 감지
- 사용자 문의를 통해 좌석 예약 실패율 증가 확인

### **2.2 1차 대응 조치**

- **트래픽 제어** : 대기열 API에 Rate Limiting 적용하여 순간적인 요청 제한
- **서버 확장 및 리소스 확보** : 오토 스케일링을 통해 API 서버 및 Redis 인스턴스 증설
- **장애 지점 격리** : 특정 API 노드에서 부하 집중 확인 → 해당 노드 트래픽 우회

---

## **3. 장애 원인 분석**

### **3.1 대기열 API 지연 원인**

1. **동시 요청 급증으로 인한 Redis 부하 증가**
    - 중복 토큰 확인을 위해 Redis 조회 연산 다수 발생
    - Redis 성능 저하로 인해 응답 속도 지연
2. **불필요한 트랜잭션 처리**
    - 대기열 진입 시, 중복 검사를 위한 트랜잭션 처리로 응답 속도 저하

### **3.2 좌석 예약 API 실패 원인**

1. **경합 조건 발생**
    - 하나의 좌석에 1000명이 동시 요청 → 락 경쟁 증가
2. **DB 부하 증가**
    - 불필요한 트랜잭션 조회(사용자,콘서트,스케줄 각각 조회)로 인해 데이터베이스 응답 속도 저하

---

## **4. 장애 해결 및 재발 방지 대책**

### **4.1 대기열 API 최적화**

**Redis 조회 최적화**

- 중복 검사를 Lua Script 또는 Redis Pipeline 이용한 원자적 연산으로 변경
- 기존 조회 방식 개선하여 불필요한 호출 제거

**트래픽 분산**

- API Gateway를 활용하여 트래픽을 균등하게 분배
- 대기열 진입 요청을 처리하는 전용 노드를 분리하여 부하 감소

### **4.2 좌석 예약 API 최적화**

**DB 부하 경감**

- 예약 좌석 상태를 캐시에 저장하여 DB 조회 최소화
- 예약 요청 시, 필요한 최소한의 트랜잭션만 실행
- 좌석 예약 요청을 큐 기반 비동기 처리 방식으로 개선

---

## **5. 후속 조치 및 개선 계획**

### **5.1 테스트 및 검증**

- **성능 테스트 강화**
  - 대기열 API와 좌석 예약 API에 대한 **정기적인 부하 테스트 수행**
  - 다양한 시나리오(트래픽 폭증, 장애 발생 시 대응) 기반 테스트 추가

### **5.2 모니터링**

- 대기열 및 좌석 예약 API의 **실시간 응답 속도 모니터링** 추가
- 트랜잭션 처리량 및 DB 커넥션 개수에 대한 경고 알람 설정

### **5.3 장애 대응 프로세스 개선**

- 장애 발생 시 빠르게 대응할 수 있도록 **대응 가이드 문서화**
- 장애 대응 모의 훈련 진행하여 대응 역량 강화