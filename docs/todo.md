### Q. 대기열 진입 시점을 언제로 하는 게 좋을까

1. 예약 페이지 접속 시
- 날짜, 좌석 조회를 대기열에 진입한 사용자만 수행 가능
- 예약 의사가 없는 유저도 대기열에 포함될 수 있어 대기열이 불필요하게 길어질 가능성.
- 단순 조회를 원하는 유저에게 불편함.
2. 좌석 예약 시
- 유저가 날짜, 좌석을 선택하고 예약을 시도할 때 대기열 진입
- 예약 의사가 확실한 유저만 대기열에 포함시키기 때문에 불필요한 토큰 발급 x
- 대기열 진입 후에는 예약 절차가 바로 진행됨.

### Q. 대기열 토큰의 정확한 역할이 무엇일까

- 대기열에 진입하기 위한 키.
- 대기열 진입에만 필요한 토큰이라면, 꼭 결제 후에 토큰 만료 처리를 해야 할까?

### Q. 좌석 임시 배정 상태를 어떻게 할까
- 좌석 테이블의 해당 좌석을 UNVALIABLE 상태로 수정한다.
- 5분 안에 결제하지 않으면 해당 좌석을 ABALIABLE 상태로 수정한다.
- 이런 경우, 5분이 지나면 좌석 상태를 수정해줘야 하는데 어떻게..? 배치를 돌려?
- 좌석 상태 변경 없이 해당 좌석 row에 lock을 걸면 되는건가?
  5분 뒤에 lock 이 풀리게?
- Redis 기반의 분산 락과 TTL(Time-To-Live)
    - TTL
    1. 좌석 상태를 Redis에 저장 → 좌석 ID를 키로 사용하여, 유저 정보 또는 임시 배정 상태를 값으로 저장한다.
    2. Redis의 EXPIRE 명령을 사용해 키의 유효기간 설정
    3. TTL이 만료되면 Redis에서 해당 키가 자동으로 삭제.
    4. 시간 안에 결제까지 진행했다면 수동으로 Redis의 좌석 정보를 삭제해야 한다.
    - 분산락
    1. 좌석 예약 요청이 들어오면, Redis의 SETNX 명령으로 락을 건다.
    2. 락은 예약요청이 완료되거나 TTL이 만료되면 자동으로 해제된다.
    3. 좌석에 락이 걸려 있는 상태에서 다른 유저가 동일 좌석을 선택하려 하면, 요청을 거절해야 한다.

### Q. 대기열 경쟁은 어떻게?
- 콘서트마다 대기열이 하나씩 존재.
- 유저 ID만 보내면 어떤 콘서트에 대한 대기열 토큰인지 모른다.
- 유저ID, 콘서트ID를 보낸다면?
  - 날짜마다의 대기열이 필요한건 아닐까? → 너무 복잡하다.

### Q. 토큰 상태 정의
**ACTIVE**
- 유저가 대기열에 진입한 상태.
- 대기열 상태를 확인하거나 순번을 조회할 때만 사용 가능.
- 예약 관련 API 호출은 불가능.
- 유저가 대기열을 이탈하지 않는 이상 상태가 유지됨.

**PASSED**
- 유저가 대기열을 통과한 상태.
- 예약 관련 API 호출이 가능.
- 대기열 상태 조회는 불필요.
- 예약 완료 또는 일정 시간이 지나면 만료 처리 필요.

**EXPIRED**
- 토큰이 만료된 상태.
- 대기열 및 예약 관련 모든 API 호출 불가능.
- 이미 사용된 토큰이므로 재사용 방지.